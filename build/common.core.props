<?xml version="1.0" encoding="utf-8"?>
<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

  <!--Build output setting-->
  <PropertyGroup>
    <EnlistmentRoot>$([MSBuild]::GetDirectoryNameOfFileAbove($(MSBuildProjectDirectory), 'build.ps1'))</EnlistmentRoot>
    <EnlistmentRootSrc>$(EnlistmentRoot)\src</EnlistmentRootSrc>

    <ArtifactRoot>$(EnlistmentRoot)\artifacts</ArtifactRoot>
    <ArtifactRoot>$([System.IO.Path]::GetFullPath( $(ArtifactRoot) ))</ArtifactRoot>

    <Configuration Condition=" '$(Configuration)' == '' ">Debug</Configuration>

    <OutputPath>$(ArtifactRoot)\$(MSBuildProjectName)</OutputPath>
    <OutputPath>$([System.IO.Path]::GetFullPath( $(OutputPath) ))\</OutputPath>

    <AppxPackageDir>$(OutputPath)</AppxPackageDir>

    <SolutionDir Condition="$(SolutionDir) == '' Or $(SolutionDir) == '*Undefined*'">$(EnlistmentRoot)\</SolutionDir>
  </PropertyGroup>

  <PropertyGroup Condition=" '$(BuildNumber)' == '' ">
    <SemanticVersionDate>2017-02-27</SemanticVersionDate>
    <Ticks1>$([System.DateTime]::Parse($(SemanticVersionDate)).Ticks)</Ticks1>
    <Ticks2>$([System.DateTime]::Now.Ticks)</Ticks2>
    <SpanTicks>$([MSBuild]::Subtract($(Ticks2), $(Ticks1)))</SpanTicks>
    <SpanMinutes>$([System.TimeSpan]::FromTicks($(SpanTicks)).TotalMinutes)</SpanMinutes>
    <BuildNumber>$([System.String]::Format('{0:F0}', $([MSBuild]::Divide($([System.Convert]::ToDouble($(SpanMinutes))), 5))))</BuildNumber>
  </PropertyGroup>

  <PropertyGroup Condition="'$(ReleaseLabel)' == ''">
    <ReleaseLabel>zlocal</ReleaseLabel>
  </PropertyGroup>

  <PropertyGroup>
    <SchemaVersion>2.0</SchemaVersion>
    <TypeScriptCompileBlocked>True</TypeScriptCompileBlocked>
    <ProduceOutputsOnBuild>True</ProduceOutputsOnBuild>
  </PropertyGroup>

  <!-- SemVer -->
  <PropertyGroup>
    <VersionSuffix Condition=" '$(VersionSuffix)' == '' ">$(ReleaseLabel)-$(BuildNumber)</VersionSuffix>
    <VersionPrefix Condition=" '$(VersionPrefix)' == '' ">4.3.0</VersionPrefix>
  </PropertyGroup>

  <PropertyGroup Condition=" '$(TargetFramework)' == 'net45' OR '$(TargetFramework)' == 'net46' ">
    <DefineConstants>$(DefineConstants);IS_DESKTOP</DefineConstants>
  </PropertyGroup>

  <PropertyGroup Condition=" '$(TargetFramework)' == 'netstandard1.0' OR '$(TargetFramework)' == 'netstandard1.3' OR '$(TargetFramework)' == 'netstandard1.4' OR '$(TargetFramework)' == 'netstandard1.5' OR '$(TargetFramework)' == 'netstandard1.6' ">
    <DefineConstants>$(DefineConstants);IS_CORECLR</DefineConstants>
  </PropertyGroup>
</Project>